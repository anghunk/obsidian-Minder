/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var A=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var _=(a,e)=>{for(var t in e)A(a,t,{get:e[t],enumerable:!0})},Q=(a,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of U(e))!G.call(a,n)&&n!==t&&A(a,n,{get:()=>e[n],enumerable:!(i=z(e,n))||i.enumerable});return a};var J=a=>Q(A({},"__esModule",{value:!0}),a);var K={};_(K,{default:()=>y});module.exports=J(K);var j=require("obsidian");var d=require("obsidian"),B={notesFolder:"minder",dateFormat:"YYYY-MM-DD HH:mm:ss",displayCount:50,defaultSort:"createTime",openOnStartup:!1},f=class extends d.PluginSettingTab{constructor(t,i){super(t,i);this.plugin=i}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Minder \u8BBE\u7F6E"}),new d.Setting(t).setName("\u7B14\u8BB0\u5B58\u50A8\u8DEF\u5F84").setDesc("\u6307\u5B9A\u4FDD\u5B58\u7B14\u8BB0\u7684\u6587\u4EF6\u5939\u8DEF\u5F84").addText(i=>i.setPlaceholder("\u4F8B\u5982: minder").setValue(this.plugin.settings.notesFolder).onChange(async n=>{this.plugin.settings.notesFolder=n,await this.plugin.saveSettings()})),new d.Setting(t).setName("\u65E5\u671F\u683C\u5F0F").setDesc("\u7B14\u8BB0\u7684\u65E5\u671F\u663E\u793A\u683C\u5F0F").addText(i=>i.setPlaceholder("YYYY-MM-DD HH:mm:ss").setValue(this.plugin.settings.dateFormat).onChange(async n=>{this.plugin.settings.dateFormat=n,await this.plugin.saveSettings()})),new d.Setting(t).setName("\u663E\u793A\u6570\u91CF").setDesc("\u6BCF\u4E2A\u89C6\u56FE\u663E\u793A\u7684\u7B14\u8BB0\u6570\u91CF\u4E0A\u9650").addText(i=>i.setPlaceholder("50").setValue(String(this.plugin.settings.displayCount)).onChange(async n=>{let s=Number(n);!isNaN(s)&&s>0&&(this.plugin.settings.displayCount=s,await this.plugin.saveSettings())})),new d.Setting(t).setName("\u9ED8\u8BA4\u6392\u5E8F").setDesc("\u7B14\u8BB0\u7684\u9ED8\u8BA4\u6392\u5E8F\u65B9\u5F0F").addDropdown(i=>i.addOption("createTime","\u6309\u521B\u5EFA\u65F6\u95F4\u6392\u5E8F").addOption("updateTime","\u6309\u7F16\u8F91\u65F6\u95F4\u6392\u5E8F").setValue(this.plugin.settings.defaultSort).onChange(async n=>{this.plugin.settings.defaultSort=n,await this.plugin.saveSettings()})),new d.Setting(t).setName("\u8F6F\u4EF6\u542F\u52A8\u65F6\u6253\u5F00\u63D2\u4EF6").setDesc("Obsidian\u542F\u52A8\u65F6\u81EA\u52A8\u6253\u5F00Minder\u63D2\u4EF6").addToggle(i=>i.setValue(this.plugin.settings.openOnStartup).onChange(async n=>{this.plugin.settings.openOnStartup=n,await this.plugin.saveSettings()}))}};var l=require("obsidian");var H=require("obsidian");async function V(a,e){a.vault.getAbstractFileByPath(e)instanceof H.TFolder||await a.vault.createFolder(e)}function I(a){let e=a.match(/minder-(\d+)\.md$/);if(e&&e.length>=2){let i=parseInt(e[1],10);return{id:i.toString(),createdAt:i}}let t=Date.now();return{id:t.toString(),createdAt:t}}function O(){return Date.now().toString()}function h(a){let e=/#([^\s#]+)/g,t=a.match(e);return t?[...new Set(t.map(i=>i.substring(1)))]:[]}function R(a){return`minder-${a.createdAt}.md`}function k(a){let e=a.tags.length>0?a.tags.map(i=>`#${i}`).join(" "):"",t=new Date(a.createdAt).toISOString();return`---
id: ${a.id}
created: ${t}
updated: ${new Date(a.updatedAt).toISOString()}
tags: ${e}
---

${a.content}
`}function D(a,e,t){let i=/^---\n([\s\S]*?)\n---\n/,n=a.match(i),s={},r=a;n&&(n[1].split(`
`).forEach(E=>{let[F,...Y]=E.split(":").map(W=>W.trim()),P=Y.join(":").trim();F&&P&&(s[F]=P)}),r=a.substring(n[0].length).trim());let o=s.tags?s.tags.split(" ").filter(Boolean).map(m=>m.replace(/^#/,"")):h(r);return{id:s.id||e,content:r,createdAt:s.created?new Date(s.created).getTime():t,updatedAt:s.updated?new Date(s.updated).getTime():Date.now(),tags:o}}var M=class{constructor(e,t){this.app=e,this.memoFolder=t}async initialize(){await V(this.app,this.memoFolder)}async createMemo(e){let t=Date.now(),i=O(),n=h(e),s={id:i,content:e,createdAt:t,updatedAt:t,tags:n},r=R(s),o=`${this.memoFolder}/${r}`,m=k(s);return await this.app.vault.create(o,m),s}async updateMemo(e,t){let i=await this.getMemoById(e);if(!i||!i.linkedFile)return null;let n={...i,content:t,updatedAt:Date.now(),tags:h(t)},s=k(n);return await this.app.vault.modify(i.linkedFile,s),n}async deleteMemo(e){let t=await this.getMemoById(e);return!t||!t.linkedFile?!1:(await this.app.vault.delete(t.linkedFile),!0)}async getMemoById(e){let i=this.app.vault.getFiles().find(o=>o.path.startsWith(this.memoFolder)&&o.name.includes(e));if(!i)return null;let n=await this.app.vault.read(i),{createdAt:s}=I(i.name);return{...D(n,e,s),linkedFile:i}}async getAllMemos(e,t="createTime"){let i=this.app.vault.getFiles().filter(s=>s.path.startsWith(this.memoFolder)&&s.extension==="md"),n=[];for(let s of i)try{let{id:r,createdAt:o}=I(s.name),m=await this.app.vault.read(s),c=D(m,r,o);n.push({...c,linkedFile:s})}catch(r){console.error(`Failed to parse memo file: ${s.name}`,r)}return n.sort((s,r)=>t==="createTime"?r.createdAt-s.createdAt:r.updatedAt-s.updatedAt),e?n.slice(0,e):n}async searchMemos(e){return(await this.getAllMemos()).filter(i=>!(e.text&&!i.content.toLowerCase().includes(e.text.toLowerCase())||e.tags&&e.tags.length>0&&!e.tags.every(s=>i.tags.includes(s))||e.timeRange&&(e.timeRange.from&&i.createdAt<e.timeRange.from||e.timeRange.to&&i.createdAt>e.timeRange.to)))}};var T=class{constructor(e,t){this.app=e,this.memoService=t}async getAllTags(){let e=await this.memoService.getAllMemos(),t={};return e.forEach(i=>{i.tags.forEach(n=>{t[n]||(t[n]=0),t[n]++})}),Object.keys(t).map(i=>({name:i,count:t[i]})).sort((i,n)=>n.count-i.count)}async getPopularTags(e=10){return(await this.getAllTags()).slice(0,e)}async renameTag(e,t){if(e===t)return 0;let i=await this.memoService.searchMemos({tags:[e]}),n=0;for(let s of i){let r=s.content.replace(new RegExp(`#${e}\\b`,"g"),`#${t}`);r!==s.content&&(await this.memoService.updateMemo(s.id,r),n++)}return n}async deleteTag(e){let t=await this.memoService.searchMemos({tags:[e]}),i=0;for(let n of t){let s=n.content.replace(new RegExp(`#${e}\\b`,"g"),"");s!==n.content&&(await this.memoService.updateMemo(n.id,s),i++)}return i}async mergeTags(e,t){let i=0;for(let n of e)n!==t&&(i+=await this.renameTag(n,t));return i}};var u=require("obsidian");var w=class{constructor(e){this.app=e.app,this.memoService=e.memoService,this.onSubmitCallback=e.onSubmit||(()=>{}),this.onCancelCallback=e.onCancel||(()=>{}),this.initialContent=e.initialContent||"",this.editingMemo=e.editingMemo,this.containerEl=document.createElement("div"),this.containerEl.className="minder-editor"}render(e){this.containerEl.empty(),e.appendChild(this.containerEl);let t=this.containerEl.createDiv({cls:"minder-editor-container"});this.textArea=new u.TextAreaComponent(t),this.textArea.setPlaceholder("\u8F93\u5165\u4F60\u7684\u60F3\u6CD5...").setValue(this.initialContent).onChange(()=>{this.previewTags(),this.adjustTextareaHeight()}),this.textArea.inputEl.className="minder-editor-textarea",this.textArea.inputEl.focus(),this.setupAutoResize();let i=this.containerEl.createDiv({cls:"minder-editor-bottom-bar"});this.tagPreviewEl=i.createDiv({cls:"minder-tag-preview"});let n=i.createDiv({cls:"minder-editor-buttons"});this.cancelButton=new u.ButtonComponent(n),this.cancelButton.setButtonText("\u53D6\u6D88").onClick(()=>{this.clear(),this.onCancelCallback()});let s=this.cancelButton.buttonEl;return s.style.display=this.editingMemo?"flex":"none",new u.ButtonComponent(n).setIcon("lucide-send-horizontal").setCta().setTooltip("\u53D1\u9001").onClick(()=>this.submitMemo()),this.previewTags(),this.adjustTextareaHeight(),this.containerEl}setupAutoResize(){!this.textArea||!this.textArea.inputEl||(this.textArea.inputEl.addEventListener("input",()=>{this.adjustTextareaHeight()}),window.addEventListener("resize",()=>{this.adjustTextareaHeight()}))}adjustTextareaHeight(){if(!this.textArea||!this.textArea.inputEl)return;let e=this.textArea.inputEl;e.style.height="auto",e.style.height=e.scrollHeight+"px"}previewTags(){if(!this.tagPreviewEl)return;this.tagPreviewEl.empty();let e=this.textArea.getValue(),t=h(e);t.length>0&&(this.tagPreviewEl.createSpan({text:"\u6807\u7B7E: "}),t.forEach(i=>{this.tagPreviewEl.createSpan({cls:"minder-tag-preview-item"}).setText(i)}))}async submitMemo(){let e=this.textArea.getValue();if(!e.trim())return;let t;try{if(this.editingMemo){let i=await this.memoService.updateMemo(this.editingMemo.id,e);if(i)t=i;else throw new Error("\u66F4\u65B0\u7B14\u8BB0\u5931\u8D25")}else t=await this.memoService.createMemo(e);this.clear(),this.onSubmitCallback(t)}catch(i){console.error("\u4FDD\u5B58\u7B14\u8BB0\u65F6\u51FA\u9519:",i)}}clear(){this.textArea&&(this.textArea.setValue(""),this.tagPreviewEl&&this.tagPreviewEl.empty(),this.editingMemo=void 0,this.cancelButton&&(this.cancelButton.buttonEl.style.display="none"),this.adjustTextareaHeight())}getContent(){return this.textArea?this.textArea.getValue():""}setContent(e){this.textArea&&(this.textArea.setValue(e),this.previewTags(),this.adjustTextareaHeight())}setEditMode(e){this.editingMemo=e,this.setContent(e.content),this.cancelButton&&(this.cancelButton.buttonEl.style.display="flex")}};var p=require("obsidian");var N=require("obsidian");function L(a,e){return(0,N.moment)(a).format(e)}function $(a){let t=Date.now()-a;return t<60*1e3?"\u521A\u521A":t<60*60*1e3?`${Math.floor(t/6e4)}\u5206\u949F\u524D`:t<24*60*60*1e3?`${Math.floor(t/36e5)}\u5C0F\u65F6\u524D`:t<7*24*60*60*1e3?`${Math.floor(t/864e5)}\u5929\u524D`:L(a,"YYYY-MM-DD")}var v=require("obsidian");var S=class{constructor(e){this.app=e.app,this.memoService=e.memoService,this.memo=e.memo,this.onSubmitCallback=e.onSubmit,this.onCancelCallback=e.onCancel,this.containerEl=document.createElement("div"),this.containerEl.className="minder-inline-editor"}render(e){this.containerEl.empty(),e.appendChild(this.containerEl);let t=this.containerEl.createDiv({cls:"minder-inline-editor-container"});this.textArea=new v.TextAreaComponent(t),this.textArea.setPlaceholder("\u8F93\u5165\u4F60\u7684\u60F3\u6CD5...").setValue(this.memo.content).onChange(()=>{this.previewTags(),this.adjustTextareaHeight()}),this.textArea.inputEl.className="minder-inline-editor-textarea",this.textArea.inputEl.focus(),this.setupAutoResize();let i=this.containerEl.createDiv({cls:"minder-inline-editor-bottom-bar"});this.tagPreviewEl=i.createDiv({cls:"minder-tag-preview"});let n=i.createDiv({cls:"minder-inline-editor-buttons"});return new v.ButtonComponent(n).setButtonText("\u53D6\u6D88").onClick(()=>{this.onCancelCallback()}),new v.ButtonComponent(n).setButtonText("\u4FDD\u5B58").setCta().onClick(()=>this.submitMemo()),this.previewTags(),this.adjustTextareaHeight(),this.containerEl}setupAutoResize(){!this.textArea||!this.textArea.inputEl||(this.textArea.inputEl.addEventListener("input",()=>{this.adjustTextareaHeight()}),window.addEventListener("resize",()=>{this.adjustTextareaHeight()}))}adjustTextareaHeight(){if(!this.textArea||!this.textArea.inputEl)return;let e=this.textArea.inputEl;e.style.height="auto",e.style.height=e.scrollHeight+"px"}previewTags(){if(!this.tagPreviewEl)return;this.tagPreviewEl.empty();let e=this.textArea.getValue(),t=h(e);t.length>0&&(this.tagPreviewEl.createSpan({text:"\u6807\u7B7E: "}),t.forEach(i=>{this.tagPreviewEl.createSpan({cls:"minder-tag-preview-item"}).setText(i)}))}async submitMemo(){let e=this.textArea.getValue();if(e.trim())try{let t=await this.memoService.updateMemo(this.memo.id,e);if(t)this.onSubmitCallback(t);else throw new Error("\u66F4\u65B0\u7B14\u8BB0\u5931\u8D25")}catch(t){console.error("\u4FDD\u5B58\u7B14\u8BB0\u65F6\u51FA\u9519:",t)}}getContent(){return this.textArea?this.textArea.getValue():""}focus(){this.textArea&&this.textArea.inputEl&&this.textArea.inputEl.focus()}};var C=class{constructor(e){this.inlineEditor=null;this.app=e.app,this.memo=e.memo,this.memoService=e.memoService,this.dateFormat=e.dateFormat,this.showTimestamp=e.showTimestamp,this.onEditCallback=e.onEdit||(()=>{}),this.onDeleteCallback=e.onDelete||(()=>{}),this.onClickCallback=e.onClick||(()=>{}),this.onUpdateCallback=e.onUpdate||(()=>{}),this.component=e.component||null,this.isEditing=!1,this.containerEl=document.createElement("div"),this.containerEl.className="minder-memo-item",this.containerEl.dataset.id=this.memo.id}render(e){this.containerEl.empty(),e.appendChild(this.containerEl),this.isEditing?this.containerEl.classList.add("minder-memo-editing"):this.containerEl.classList.remove("minder-memo-editing");let t=this.containerEl.createDiv({cls:"minder-memo-header"});if(this.showTimestamp){let s=t.createDiv({cls:"minder-memo-time"});s.setText($(this.memo.createdAt)),s.setAttribute("title",L(this.memo.createdAt,this.dateFormat))}let i=t.createDiv({cls:"minder-memo-actions"});this.isEditing&&i.createDiv({cls:"minder-memo-editing-badge"}).setText("\u7F16\u8F91\u4E2D");let n=i.createDiv({cls:"minder-memo-action-button"});if((0,p.setIcon)(n,"more-horizontal"),n.addEventListener("click",s=>{this.showActionsMenu(n,s),s.stopPropagation()}),this.contentEl=this.containerEl.createDiv({cls:"minder-memo-content"}),this.isEditing?this.renderInlineEditor():this.renderContent(this.contentEl),this.memo.tags.length>0){let s=this.containerEl.createDiv({cls:"minder-memo-tags"});this.memo.tags.forEach(r=>{let o=s.createSpan({cls:"minder-memo-tag"});o.setText("#"+r),o.addEventListener("click",m=>{m.stopPropagation()})})}return this.isEditing||(this.containerEl.addEventListener("click",()=>{this.onClickCallback(this.memo)}),this.containerEl.addEventListener("dblclick",s=>{this.startInlineEditing(),s.stopPropagation()})),this.containerEl}renderContent(e){e.empty();try{if(this.component)p.MarkdownRenderer.renderMarkdown(this.memo.content,e,"",this.component);else{let t=e.createEl("p");t.textContent=this.memo.content}}catch(t){console.error("\u6E32\u67D3Markdown\u5185\u5BB9\u5931\u8D25:",t);let i=e.createEl("p");i.textContent=this.memo.content}}renderInlineEditor(){this.contentEl&&(this.contentEl.empty(),this.inlineEditor=new S({app:this.app,memoService:this.memoService,memo:this.memo,onSubmit:e=>{this.memo=e,this.setEditingState(!1),this.renderContent(this.contentEl),this.updateTagsSection(),this.onUpdateCallback(e)},onCancel:()=>{this.setEditingState(!1),this.renderContent(this.contentEl),this.updateTagsSection()}}),this.inlineEditor.render(this.contentEl),this.inlineEditor&&setTimeout(()=>{var e;(e=this.inlineEditor)==null||e.focus()},10))}updateTagsSection(){let e=this.containerEl.querySelector(".minder-memo-tags");if(this.memo.tags.length>0)if(e)e.empty(),this.memo.tags.forEach(t=>{let i=e.createSpan({cls:"minder-memo-tag"});i.setText("#"+t),i.addEventListener("click",n=>{n.stopPropagation()})});else{let t=this.containerEl.createDiv({cls:"minder-memo-tags"});this.memo.tags.forEach(i=>{let n=t.createSpan({cls:"minder-memo-tag"});n.setText("#"+i),n.addEventListener("click",s=>{s.stopPropagation()})})}else e&&e.remove()}startInlineEditing(){this.onEditCallback(this.memo),this.setEditingState(!0),this.renderInlineEditor()}showActionsMenu(e,t){let i=new p.Menu;i.addItem(n=>{n.setTitle("\u7F16\u8F91").setIcon("pencil").onClick(()=>{this.startInlineEditing()})}),i.addItem(n=>{let s=n.setTitle("\u5220\u9664").setIcon("trash").onClick(()=>{this.showDeleteConfirmation()}),r=s.titleEl;r&&(r.style.color="var(--text-error)");let o=s.iconEl;o&&(o.style.color="var(--text-error)")}),this.memo.linkedFile&&i.addItem(n=>{n.setTitle("\u8FDB\u5165\u6E90\u6587\u4EF6").setIcon("file-text").onClick(()=>{this.app.workspace.getLeaf().openFile(this.memo.linkedFile)})}),i.showAtMouseEvent(t)}update(e){this.memo=e;let t=this.containerEl.parentElement;t&&this.render(t)}setEditingState(e){this.isEditing=e,this.containerEl&&(e?this.containerEl.classList.add("minder-memo-editing"):(this.containerEl.classList.remove("minder-memo-editing"),this.inlineEditor=null))}async saveCurrentEdit(){if(!(!this.isEditing||!this.inlineEditor))try{let e=this.inlineEditor.getContent();if(!e.trim()||e===this.memo.content){this.setEditingState(!1),this.renderContent(this.contentEl),this.updateTagsSection();return}let t=await this.memoService.updateMemo(this.memo.id,e);t&&(this.memo=t,this.setEditingState(!1),this.renderContent(this.contentEl),this.updateTagsSection(),this.onUpdateCallback(t))}catch(e){console.error("\u4FDD\u5B58\u7B14\u8BB0\u65F6\u51FA\u9519:",e),this.setEditingState(!1),this.renderContent(this.contentEl)}}showDeleteConfirmation(){let e=new p.Modal(this.app);e.titleEl.setText("\u786E\u8BA4\u5220\u9664");let t=e.contentEl;t.empty();let i=t.createDiv();i.setText("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u6761\u7B14\u8BB0\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002"),i.style.marginBottom="20px";let n=t.createDiv({cls:"minder-delete-preview"});n.style.padding="10px",n.style.background="var(--background-secondary)",n.style.borderRadius="5px",n.style.marginBottom="20px",n.style.maxHeight="100px",n.style.overflow="auto";let s=this.memo.content.length>50?this.memo.content.substring(0,50)+"...":this.memo.content;n.setText(s);let r=t.createDiv();r.style.display="flex",r.style.justifyContent="flex-end",r.style.gap="10px";let o=r.createEl("button");o.setText("\u53D6\u6D88"),o.addEventListener("click",()=>{e.close()});let m=r.createEl("button");m.setText("\u5220\u9664"),m.classList.add("mod-warning"),m.addEventListener("click",()=>{this.onDeleteCallback(this.memo),e.close()}),e.open()}getContainerEl(){return this.containerEl}};var x=class{constructor(e){this.tags=[];this.selectedTag=null;this.app=e.app,this.tagService=e.tagService,this.onTagClickCallback=e.onTagClick||(()=>{}),this.containerEl=document.createElement("div"),this.containerEl.className="minder-tags-bar"}async render(e){this.containerEl.empty(),e.appendChild(this.containerEl),await this.loadTags();let t=this.containerEl.createDiv({cls:"minder-tag-item"});t.classList.toggle("minder-tag-selected",this.selectedTag===null),t.setText("\u5168\u90E8"),t.addEventListener("click",()=>this.selectTag(null));for(let i of this.tags){let n=this.containerEl.createDiv({cls:"minder-tag-item"});n.classList.toggle("minder-tag-selected",i.name===this.selectedTag),n.createSpan({text:i.name}),n.createSpan({cls:"minder-tag-count",text:`(${i.count})`}),n.addEventListener("click",()=>this.selectTag(i.name))}return this.containerEl}async loadTags(){this.tags=await this.tagService.getAllTags()}selectTag(e){this.selectedTag=e,this.containerEl.querySelectorAll(".minder-tag-item").forEach((i,n)=>{var r;let s=n===0?this.selectedTag===null:this.selectedTag===((r=this.tags[n-1])==null?void 0:r.name);i.classList.toggle("minder-tag-selected",s)}),e!==null?this.onTagClickCallback(e):this.onTagClickCallback("")}async refresh(){await this.loadTags(),this.containerEl.parentElement&&this.render(this.containerEl.parentElement)}getSelectedTag(){return this.selectedTag}setSelectedTag(e){this.selectTag(e)}};var g="minder-memo-view",b=class extends l.ItemView{constructor(t,i){super(t);this.memos=[];this.currentViewType="all";this.currentTag="";this.searchText="";this.currentEditingMemoId=null;this.memoComponents=new Map;this.isSearchVisible=!1;this.settings=i,this.memoService=new M(this.app,this.settings.notesFolder),this.tagService=new T(this.app,this.memoService)}getViewType(){return g}getDisplayText(){return"Minder"}getIcon(){return"lightbulb"}async onOpen(){let{containerEl:t}=this;t.empty(),await this.memoService.initialize(),t.addClass("minder-container");let i=t.createDiv({cls:"minder-editor-area"});this.editor=new w({app:this.app,memoService:this.memoService,placeholder:"\u8F93\u5165\u4F60\u7684\u60F3\u6CD5...",onSubmit:async c=>{var E;this.currentEditingMemoId&&this.clearEditingState(),await this.refreshMemos(),await((E=this.tagsBar)==null?void 0:E.refresh())},onCancel:()=>{this.clearEditingState()}}),this.editor.render(i);let n=t.createDiv({cls:"minder-top-bar"});this.searchEl=n.createDiv({cls:"minder-search"}),this.searchEl.style.display="none";let s=this.searchEl.createEl("input",{type:"text",placeholder:"\u641C\u7D22\u7B14\u8BB0...",cls:"minder-search-input"});s.addEventListener("input",c=>{this.searchText=c.target.value,this.refreshMemos()}),s.addEventListener("keydown",c=>{c.key==="Escape"&&(this.hideSearch(),c.preventDefault(),c.stopPropagation())});let r=t.createDiv({cls:"minder-tags-area"}),o=r.createDiv({cls:"minder-buttons-container"}),m=o.createDiv({cls:"minder-refresh-button"});(0,l.setIcon)(m,"refresh-cw"),m.setAttribute("aria-label","\u5237\u65B0\u7B14\u8BB0"),m.addEventListener("click",async()=>{var c;await this.refreshMemos(),await((c=this.tagsBar)==null?void 0:c.refresh()),new l.Notice("\u7B14\u8BB0\u5DF2\u5237\u65B0")}),this.searchButton=o.createDiv({cls:"minder-search-button"}),(0,l.setIcon)(this.searchButton,"search"),this.searchButton.setAttribute("aria-label","\u641C\u7D22\u7B14\u8BB0"),this.searchButton.addEventListener("click",()=>{this.toggleSearchVisibility()}),this.tagsBar=new x({app:this.app,tagService:this.tagService,onTagClick:c=>{this.currentTag=c,this.currentViewType=c?"tag":"all",this.refreshMemos()}}),await this.tagsBar.render(r),this.memoContentEl=t.createDiv({cls:"minder-content-area"}),this.memosContainer=this.memoContentEl.createDiv({cls:"minder-memos-container"}),this.refreshMemos()}showSearch(){this.isSearchVisible=!0,this.searchEl.style.display="block",this.searchButton.classList.add("active");let t=this.searchEl.querySelector(".minder-search-input");t&&setTimeout(()=>t.focus(),10)}hideSearch(){this.isSearchVisible=!1,this.searchEl.style.display="none",this.searchButton.classList.remove("active");let t=this.searchEl.querySelector(".minder-search-input");t&&(t.value="",this.searchText="",this.refreshMemos())}toggleSearchVisibility(){this.isSearchVisible?this.hideSearch():this.showSearch()}async onClose(){}async refreshMemos(){this.memosContainer.empty(),this.memoComponents.clear();try{switch(this.currentViewType){case"tag":this.currentTag?this.memos=await this.memoService.searchMemos({tags:[this.currentTag],text:this.searchText}):this.memos=await this.memoService.getAllMemos(this.settings.displayCount,this.settings.defaultSort);break;case"all":default:this.searchText?this.memos=await this.memoService.searchMemos({text:this.searchText}):this.memos=await this.memoService.getAllMemos(this.settings.displayCount,this.settings.defaultSort);break}for(let t of this.memos){let i=new C({app:this.app,memo:t,memoService:this.memoService,dateFormat:this.settings.dateFormat,showTimestamp:!0,onEdit:n=>this.editMemo(n),onDelete:n=>this.deleteMemo(n),onUpdate:async n=>{var s;await((s=this.tagsBar)==null?void 0:s.refresh()),this.currentViewType==="tag"&&this.currentTag&&(n.tags.includes(this.currentTag)||await this.refreshMemos())},component:this});i.render(this.memosContainer),this.memoComponents.set(t.id,i),this.currentEditingMemoId===t.id&&i.setEditingState(!0)}this.memos.length===0&&this.memosContainer.createDiv({cls:"minder-empty-state"}).setText("\u6682\u65E0\u7B14\u8BB0")}catch(t){console.error("\u52A0\u8F7D\u7B14\u8BB0\u5931\u8D25",t),new l.Notice("\u52A0\u8F7D\u7B14\u8BB0\u5931\u8D25")}}editMemo(t){if(this.currentEditingMemoId&&this.currentEditingMemoId!==t.id){let n=this.memoComponents.get(this.currentEditingMemoId);n&&n.saveCurrentEdit()}this.clearEditingState(),this.currentEditingMemoId=t.id;let i=this.memoComponents.get(t.id);if(i){i.setEditingState(!0);let n=i.getContainerEl();n&&n.scrollIntoView({behavior:"smooth",block:"nearest"})}}async deleteMemo(t){try{this.currentEditingMemoId===t.id&&this.clearEditingState(),await this.memoService.deleteMemo(t.id),await this.refreshMemos(),await this.tagsBar.refresh(),new l.Notice("\u7B14\u8BB0\u5DF2\u5220\u9664")}catch(i){console.error("\u5220\u9664\u7B14\u8BB0\u5931\u8D25",i),new l.Notice("\u5220\u9664\u7B14\u8BB0\u5931\u8D25")}}clearEditingState(){if(this.currentEditingMemoId){let t=this.memoComponents.get(this.currentEditingMemoId);t&&t.setEditingState(!1),this.currentEditingMemoId=null}}focusEditor(){var t;if(this.editor){(t=this.containerEl.querySelector(".minder-editor-area"))==null||t.scrollIntoView({behavior:"smooth",block:"center"});let i=this.containerEl.querySelector(".minder-editor-textarea");i&&i.focus()}}};var y=class extends j.Plugin{async onload(){await this.loadSettings(),this.registerView(g,t=>new b(t,this.settings)),this.addRibbonIcon("lightbulb","Minder \u5FEB\u901F\u7B14\u8BB0",async()=>{await this.activateView()}),this.addCommand({id:"open-minder",name:"\u6253\u5F00 Minder \u7B14\u8BB0\u89C6\u56FE",callback:async()=>{await this.activateView()}}),this.addCommand({id:"add-quick-memo",name:"\u5FEB\u901F\u6DFB\u52A0\u7B14\u8BB0",callback:()=>{this.activateView().then(()=>{let t=this.app.workspace.getLeavesOfType(g)[0];t&&t.view.focusEditor()})}}),this.addSettingTab(new f(this.app,this)),this.settings.openOnStartup&&setTimeout(()=>{this.activateView()},500)}onunload(){this.app.workspace.getLeavesOfType(g).forEach(t=>t.detach())}async loadSettings(){this.settings=Object.assign({},B,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:t}=this.app,i=t.getLeavesOfType(g)[0];i||(i=t.getLeaf(!1),i&&await i.setViewState({type:g,active:!0})),i&&t.revealLeaf(i)}};
